■■■ ymfmidi for Windows - FM MIDI synthesizer (ported by SimK) ■■■

ヤマハのFM音源をエミュレーションするymfm（https://github.com/aaronsgiles/ymfm）
をMIDIプレーヤーとして実装したymfmidi（https://github.com/devinacker/ymfmidi）
をさらにWindowsへ勝手に移植したものです。

□特徴
・ymfmidiをWindows向けにほぼ完全移植
・FM音源風サウンドフォントではなく完全なFM音源エミュレーション
・定義ファイルで音色を変更可能
・常駐させてMIDI INデバイスとして使用可能


●動作環境
少なくともWindows 10以降では動くと思っています


●インストール
単にMIDIファイルプレーヤーとして使用する場合は特別な作業は要りません。
アーカイブを展開して好きな場所へ置くだけでOKです。

常駐させてMIDI INデバイスとして使用する場合は、MIDI INにケーブルを繋ぐか、
仮想MIDI INを用意してください。
実際にはあるソフトのMIDI OUTをそのまま受け取りたい場合が多いと思いますので、
これを実現できるloopMIDIというソフトウェアがおすすめです。
loopMIDIを使用すると、同じ名前のMIDI INとMIDI OUTが出現します。
これらは物理的にケーブルで繋がれているのと同じ振る舞いをしますので、
あるソフトのMIDI OUTとこのプログラムのMIDI INを同じloopMIDIデバイスにすれば
あるソフトで再生されたMIDIをそのままこのプログラムへ送り込んで再生出来ます。


●アンインストール
レジストリは使用していませんのでそのまま削除してください。


●使い方
①ただのMIDIプレーヤーとして使う場合
ymfmidiwin.exe（OSが32bitの場合ymfmidiwin32.exe）にMIDIファイルを入れると再生されます。音色やOPLの種類・数などはコマンドライン引数で指示できます。

②MIDI再生デバイスとして使う場合
あらかじめloopMIDI等を入れておきます。そのあとで
ymfmidiwin.exe -t //MIDIIN0
（OSが32bitの場合ymfmidiwin32.exe）
と実行するとタスクトレイに常駐します。右クリックメニューで終了できます。
//MIDIIN1等と書くと別のMIDI INデバイスを指定できます。


●コマンドライン引数の説明
ymfmidiwin [オプション] MIDIファイル名 [音色データファイル名]

対応MIDIファイルフォーマット:  HMI, HMP, MID, MUS, RMI, XMI
対応音色データフォーマット: AD, OPL, OP2, TMB, WOPL

MIDIファイル名として//MIDIINと書くとMIDI INデバイスとして常駐します。

オプション:
  -h / --help             コマンドライン引数などの説明を表示
  -q / --quiet            チップ状態の表示やキー動作を無効にする
  -1 / --play-once        1回だけ再生して終了する（デフォルトはループ再生）
  -s / --song <num>       複数曲がある場合にどれを再生するか指示(デフォルト1)
  -o / --out <path>       指定した名前のWAVファイルに変換して出力する
                          <path>が"."の場合はファイル名に_ymfm.wavを付けて出力

  -c / --chip <num>       チップ種別(1=OPL, 2=OPL2, 3=OPL3; デフォルト3)
  -n / --num <num>        チップ数(デフォルト1)
  -m / --mono             強制モノラル化 (OPL3の場合のみ)
  -b / --buf <num>        バッファサイズ指示(デフォルト4096)
  -g / --gain <num>       音量ゲイン(デフォルト1.0)
  -r / --rate <num>       WAV出力サンプリングレート(デフォルト44100)
  -f / --filter <num>     Hz単位のハイパスフィルタカットオフ (default 5.0)

  -t / --tray             コンソール表示せずにタスクトレイに常駐する
  -p / --ptime            スリープ状態へ移行する時間(ミリ秒単位; default 15000)

なお、MIDIファイル名と音色データ名は必ずオプションの後に書く必要があります。
オフションの前にファイル指定すると動きません。

□典型的なオプション例
OPL2化する
ymfmidiwin -c 2

同時に126音鳴らせるようにする（大富豪サウンド）
ymfmidiwin -n 7

指定したMIDIファイルをWAVファイルへ出力する
ymfmidiwin -o WAVファイル名 MIDIファイル名

□オリジナルのymfmidiにない機能
MIDI INデバイスモード（コンソール）
ymfmidiwin //MIDIIN

MIDI INデバイスモード（タスクトレイ常駐）
ymfmidiwin -t //MIDIIN

指定したMIDIファイルを_ymfm.wavを付けてへ出力する
ymfmidiwin -o . MIDIファイル名
→ 例えば、test.midならtest_ymfm.wavへ出力


●その他情報
FM音源チップをエミュレーションしている関係上、再生時の負荷はまあまあ大きいです。
動作が重たい場合、--quietモードにすると多少は負荷が減ります。
また、常駐状態の時はいつでもMIDI INを受け付けられるように待機状態になっています。
これだとCPUを無駄に使いますので、デフォルトでは15秒間何も送られなかった場合に
スリープ状態になるようにしています。つまり、15秒間MIDIメッセージを送らないと音が
止まります。スリープ状態ときにMIDIメッセージを送ると再びアクティブになります。
この時間は-pオプションで変更できます。0を指定した場合はスリープしません。


●免責事項
本プログラムはフリーソフト＆無保証です。本プログラムを使用したことで何らかの
損害が発生したとしても、作者は一切の責任を負わないものとします。


●バージョン履歴
2025/12/20 ver.0.6 初版（ymfmidi ver.0.6より移植）

------------------------
Neko Project 21/W 開発者
SimK
